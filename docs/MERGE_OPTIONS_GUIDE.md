# merge-options è‡ªåŠ¨åŒ–è§†é¢‘å¤„ç†æµç¨‹

## åŠŸèƒ½æ¦‚è¿°

`merge-options` æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„è§†é¢‘å¤„ç†æµç¨‹å‘½ä»¤ï¼Œå®ƒå°†å¤šä¸ªæ­¥éª¤æ•´åˆåœ¨ä¸€èµ·ï¼Œå®ç°ä»è§†é¢‘åˆå¹¶åˆ°æœ€ç»ˆè¾“å‡ºçš„å®Œæ•´æµç¨‹ã€‚

## å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: è¯»å– processed_data.json                            â”‚
â”‚  â””â”€ ä» output/{name}/processed_data.json è¯»å–é…ç½®           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: æ›´æ–° merge-video é…ç½®                               â”‚
â”‚  â””â”€ å°† urls å­—æ®µæ›´æ–°åˆ° config.mjs çš„ merge-video é…ç½®ä¸­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: è¿è¡Œ merge-video å‘½ä»¤                               â”‚
â”‚  â””â”€ æ‰§è¡Œ npx node-ffmpeg-tools merge-video                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: æ›´æ–° history-person é…ç½®å¹¶è¿è¡Œ                      â”‚
â”‚  â”œâ”€ å°†åˆå¹¶åçš„è§†é¢‘è·¯å¾„æ›´æ–°åˆ° history-person.url             â”‚
â”‚  â”œâ”€ å°† title æ›´æ–°åˆ° history-person.title                    â”‚
â”‚  â””â”€ æ‰§è¡Œ npx node-ffmpeg-tools history-person               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 5: ç§»åŠ¨æœ€ç»ˆè§†é¢‘                                        â”‚
â”‚  â””â”€ å°†æœ€ç»ˆè§†é¢‘ç§»åŠ¨åˆ° outputUtils/{name}.mp4                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é…ç½®è¯´æ˜

### åœ¨ config.mjs ä¸­æ·»åŠ é…ç½®

```javascript
export default {
  // ... å…¶ä»–é…ç½® ...

  "merge-options": {
    name: "20251128-äºšå†å±±å¤§äºŒä¸–", // å¯¹åº” output/{name}/processed_data.json
  },

  // ... å…¶ä»–é…ç½® ...
};
```

### processed_data.json æ–‡ä»¶æ ¼å¼

è¯¥æ–‡ä»¶åº”è¯¥ä½äº `output/{name}/processed_data.json`ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "name": "20251128-äºšå†å±±å¤§äºŒä¸–",
  "timeNum": 11,
  "urls": [
    "https://example.com/video1.mp4",
    "https://example.com/video2.mp4"
  ],
  "title": "ä¿„ç½—æ–¯å¸å›½æ²™çš‡\\nä¿„å›½å†œå¥´åˆ¶æ”¹é©è€…\\näºšå†å±±å¤§äºŒä¸–çš„ä¸€ç”Ÿ",
  "segments": [
    {
      "title": "1818å¹´\\nå‡ºç”Ÿäºä¿„å›½çš‡å®¤\\nå¼€å¯å…¶äººç”Ÿå†ç¨‹",
      "prompt": "...",
      "shot": "..."
    }
    // ... æ›´å¤šç‰‡æ®µ ...
  ]
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡å·¥ä½œ

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
- `output/{name}/processed_data.json` - åŒ…å«è§†é¢‘ URLs å’Œæ ‡é¢˜ä¿¡æ¯
- `config.mjs` - åŒ…å« merge-options é…ç½®

### 2. è¿è¡Œå‘½ä»¤

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶è¿è¡Œ
npx node-ffmpeg-tools merge-options

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
npx node-ffmpeg-tools merge-options --help
```

### 3. æŸ¥çœ‹è¾“å‡º

æœ€ç»ˆè§†é¢‘å°†ä¿å­˜åœ¨ï¼š
```
outputUtils/{name}.mp4
```

## è¿›åº¦æ˜¾ç¤º

å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¿›åº¦ä¿¡æ¯ï¼š

```
============================================================
ğŸ“Š æ€»ä½“è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20%
ğŸ“ æ­¥éª¤ 1/5: è¯»å– processed_data.json é…ç½®æ–‡ä»¶
============================================================

============================================================
ğŸš€ æ‰§è¡Œè§†é¢‘åˆå¹¶
============================================================
[merge-video çš„è¾“å‡º...]
âœ… æ‰§è¡Œè§†é¢‘åˆå¹¶ - å®Œæˆ

============================================================
ğŸ“Š æ€»ä½“è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60%
ğŸ“ æ­¥éª¤ 3/5: åˆå¹¶è§†é¢‘ (merge-video)
============================================================
```

## è‡ªåŠ¨æ›´æ–°çš„é…ç½®

### merge-video é…ç½®

å‘½ä»¤ä¼šè‡ªåŠ¨æ›´æ–° `config.mjs` ä¸­çš„ `merge-video.urls`ï¼š

```javascript
"merge-video": {
  urls: [
    "https://example.com/video1.mp4",
    "https://example.com/video2.mp4"
  ],
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜ ...
}
```

### history-person é…ç½®

å‘½ä»¤ä¼šè‡ªåŠ¨æ›´æ–° `config.mjs` ä¸­çš„ `history-person.url` å’Œ `history-person.title`ï¼š

```javascript
"history-person": {
  url: "output/merge-video/merged_1234567890_merged.mp4",
  title: `ä¿„ç½—æ–¯å¸å›½æ²™çš‡\nä¿„å›½å†œå¥´åˆ¶æ”¹é©è€…\näºšå†å±±å¤§äºŒä¸–çš„ä¸€ç”Ÿ`,
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜ ...
}
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

1. **æ‰¾ä¸åˆ° processed_data.json**
   ```
   é”™è¯¯: æ— æ³•è¯»å– processed_data.json
   è§£å†³: ç¡®ä¿æ–‡ä»¶å­˜åœ¨äº output/{name}/processed_data.json
   ```

2. **é…ç½®ä¸­ç¼ºå°‘ name å­—æ®µ**
   ```
   é”™è¯¯: é…ç½®ä¸­ç¼ºå°‘ name å­—æ®µ
   è§£å†³: åœ¨ config.mjs çš„ merge-options ä¸­æ·»åŠ  name å­—æ®µ
   ```

3. **æœªæ‰¾åˆ°åˆå¹¶åçš„è§†é¢‘**
   ```
   é”™è¯¯: æœªæ‰¾åˆ° merge-video è¾“å‡ºçš„è§†é¢‘æ–‡ä»¶
   è§£å†³: æ£€æŸ¥ merge-video å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œ
   ```

4. **æœªæ‰¾åˆ°æœ€ç»ˆè§†é¢‘**
   ```
   é”™è¯¯: æœªæ‰¾åˆ° history-person è¾“å‡ºçš„æœ€ç»ˆè§†é¢‘
   è§£å†³: æ£€æŸ¥ history-person å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œ
   ```

## æ‰©å±•æ€§

è¯¥å‘½ä»¤è®¾è®¡æ—¶è€ƒè™‘äº†è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾é›†æˆå…¶ä»–å­å‘½ä»¤ï¼š

### æ·»åŠ æ–°çš„å¤„ç†æ­¥éª¤

åœ¨ `lib/merge-options.mjs` ä¸­çš„ `runMergeOptions` å‡½æ•°ä¸­æ·»åŠ æ–°æ­¥éª¤ï¼š

```javascript
// æ­¥éª¤ 6: æ·»åŠ æ–°çš„å¤„ç†æ­¥éª¤
currentStep++;
showProgress(currentStep, totalSteps, "æ‰§è¡Œæ–°çš„å¤„ç†æ­¥éª¤");

await executeCommand("new-command", "æ‰§è¡Œæ–°å‘½ä»¤");
```

### è‡ªå®šä¹‰é…ç½®æ›´æ–°é€»è¾‘

ä¿®æ”¹ `updateConfigFile` å‡½æ•°çš„è°ƒç”¨ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„é…ç½®æ›´æ–°é€»è¾‘ï¼š

```javascript
await updateConfigFile(configPath, (content) => {
  // è‡ªå®šä¹‰é…ç½®æ›´æ–°é€»è¾‘
  const regex = /("new-config":\s*\{[\s\S]*?field:\s*")[^"]*(")/;
  content = content.replace(regex, `$1${newValue}$2`);
  return content;
});
```

## æ³¨æ„äº‹é¡¹

1. **é…ç½®æ–‡ä»¶å¤‡ä»½**: å‘½ä»¤ä¼šè‡ªåŠ¨ä¿®æ”¹ `config.mjs`ï¼Œå»ºè®®åœ¨è¿è¡Œå‰å¤‡ä»½
2. **æ–‡ä»¶è¦†ç›–**: å¦‚æœ `outputUtils/{name}.mp4` å·²å­˜åœ¨ï¼Œä¼šè¢«è‡ªåŠ¨è¦†ç›–
3. **ä¸­é—´æ–‡ä»¶**: ä¸­é—´ç”Ÿæˆçš„æ–‡ä»¶ä¼šä¿ç•™åœ¨å„è‡ªçš„è¾“å‡ºç›®å½•ä¸­
4. **æ‰§è¡Œæ—¶é—´**: æ•´ä¸ªæµç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå–å†³äºè§†é¢‘å¤§å°å’Œæ•°é‡

## ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹

```bash
# 1. å‡†å¤‡ processed_data.json
cat output/20251128-äºšå†å±±å¤§äºŒä¸–/processed_data.json
{
  "name": "20251128-äºšå†å±±å¤§äºŒä¸–",
  "urls": ["https://...", "https://..."],
  "title": "äºšå†å±±å¤§äºŒä¸–çš„ä¸€ç”Ÿ"
}

# 2. é…ç½® config.mjs
# "merge-options": {
#   name: "20251128-äºšå†å±±å¤§äºŒä¸–"
# }

# 3. è¿è¡Œå‘½ä»¤
npx node-ffmpeg-tools merge-options

# 4. æŸ¥çœ‹è¾“å‡º
ls outputUtils/20251128-äºšå†å±±å¤§äºŒä¸–.mp4
```

## ç›¸å…³å‘½ä»¤

- `merge-video` - åˆå¹¶å¤šä¸ªè§†é¢‘
- `history-person` - ç”Ÿæˆå†å²äººç‰©è§†é¢‘
- `get-promot-image-by-video` - æå–è§†é¢‘å¸§å¹¶ç”Ÿæˆæç¤ºè¯

## æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶æŸ¥æ‰¾é€»è¾‘

- **merge-video è¾“å‡º**: æŸ¥æ‰¾ `output/merge-video/merged_*.mp4`ï¼Œé€‰æ‹©æœ€æ–°çš„æ–‡ä»¶
- **history-person è¾“å‡º**: æŸ¥æ‰¾ `output/history-person/*_processed.mp4`ï¼Œé€‰æ‹©æœ€æ–°çš„æ–‡ä»¶

### é…ç½®æ›´æ–°ç­–ç•¥

ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å’Œæ›¿æ¢é…ç½®å†…å®¹ï¼Œä¿æŒå…¶ä»–é…ç½®ä¸å˜ã€‚

### è¿›åº¦è®¡ç®—

æ€»å…± 5 ä¸ªæ­¥éª¤ï¼Œæ¯å®Œæˆä¸€ä¸ªæ­¥éª¤æ›´æ–°è¿›åº¦æ¡ã€‚
