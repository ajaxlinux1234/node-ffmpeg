# 手动下载解决方案

## 🚨 问题分析

从你的测试结果可以看出：
- **自动下载失败**：`Session closed. Most likely the page has been closed`
- **手动下载成功**：用鼠标手动下载就可以下载成功
- **根本原因**：即梦检测到了自动化行为并阻止了下载

## 🛠️ 解决方案

### 方案1：混合模式（推荐）

修改配置文件 `lib/auto-deepseek-jimeng/jimeng-config.mjs`：

```javascript
// 下载模式配置
downloadMode: {
  autoDownload: false, // 禁用自动下载
  manualDownloadTimeout: 300, // 手动下载等待时间（5分钟）
  manualDownloadMessage: "请手动下载图片，完成后按任意键继续...",
},
```

### 使用流程：
1. 运行 `npx node-ffmpeg-tools auto-deepseek-jimeng`
2. 程序自动打开即梦网站并生成图片
3. 当图片生成完成后，程序会暂停并提示：
   ```
   🛑 自动下载已禁用，切换到手动下载模式
   📝 请手动下载图片，完成后按任意键继续...
   ⏰ 浏览器窗口将保持打开，请手动下载所需的图片
   ```
4. 你手动下载所有图片到 `output/{name}/images/` 目录
5. 下载完成后在终端按任意键继续
6. 程序继续执行后续的视频生成流程

### 方案2：完全手动模式

如果你想完全手动操作，可以：

1. 设置 `downloadImg: false` 禁用下载功能
2. 程序只负责生成图片，不下载
3. 你手动下载所有图片
4. 单独运行视频生成：
   ```bash
   # 只运行视频生成部分
   npx node-ffmpeg-tools auto-deepseek-jimeng --video-only
   ```

## 🎯 推荐配置

```javascript
// jimeng-config.mjs
export const jimengConfig = {
  // ... 其他配置
  
  downloadImg: true, // 启用下载流程
  useImgUrl: false, // 使用点击下载模式
  
  // 下载模式配置
  downloadMode: {
    autoDownload: false, // 🔑 关键：禁用自动下载
    manualDownloadTimeout: 600, // 10分钟超时
    manualDownloadMessage: "✋ 请手动下载所有图片到 images 目录，完成后按 Enter 继续...",
  },
  
  // ... 其他配置
};
```

## 📋 手动下载步骤

1. **等待程序暂停**：看到提示信息后
2. **查看浏览器**：确认所有图片都已生成
3. **手动下载**：
   - 右键点击每张图片
   - 选择"另存为"
   - 保存到 `output/与中国人民并肩抗日的"日籍同志"-尾崎秀实/images/` 目录
   - 文件名格式：`image_1.jpg`, `image_2.jpg`, ...
4. **继续程序**：在终端按任意键继续

## 🔧 文件命名规范

确保下载的图片按以下格式命名：
```
output/
└── 与中国人民并肩抗日的"日籍同志"-尾崎秀实/
    └── images/
        ├── image_1.jpg
        ├── image_2.jpg
        ├── image_3.jpg
        ├── ...
        └── image_13.jpg
```

## 🚀 优势

### 混合模式的优势：
- ✅ **100%成功率**：手动下载绝对不会被检测
- ✅ **自动化其他步骤**：只有下载是手动的，其他都自动化
- ✅ **灵活控制**：可以选择下载哪些图片
- ✅ **质量保证**：可以确认图片质量后再下载

### 相比完全自动化：
- ✅ **避免检测**：不会触发反自动化机制
- ✅ **稳定可靠**：不会出现会话关闭的问题
- ✅ **用户控制**：可以筛选和选择最好的图片

## 📞 故障排除

### Q: 程序一直等待怎么办？
A: 在终端按任意键（如Enter）继续程序执行。

### Q: 下载的图片程序找不到怎么办？
A: 确保图片保存在正确的目录，文件名格式正确。

### Q: 可以只下载部分图片吗？
A: 可以，程序会处理你下载的所有图片，但建议下载全部以获得最佳视频效果。

### Q: 超时了怎么办？
A: 程序会在超时后自动继续，或者你可以按任意键手动继续。

---

这个方案完美解决了自动化检测的问题，让你既能享受自动化的便利，又能确保下载的成功率！
