# IP封禁问题解决方案指南

## 🚨 问题描述

如果你遇到以下情况，说明你的IP可能被即梦封禁了：
- 无头浏览器下载图片显示失败
- 网络连接正常，但无法访问即梦服务
- 使用手机热点或其他网络可以正常访问

## 🛠️ 解决方案

### 方案1：使用代理服务器（推荐）

#### 1.1 配置HTTP代理
在 `lib/auto-deepseek-jimeng/jimeng-config.mjs` 中取消注释并配置代理：

```javascript
export const jimengConfig = {
  // ... 其他配置
  
  // 代理配置 - 如果IP被封，可以使用代理
  proxy: "http://127.0.0.1:7890", // HTTP代理
  // proxy: "socks5://127.0.0.1:1080", // SOCKS5代理
  
  // ... 其他配置
};
```

#### 1.2 常用代理软件设置

**Clash for Windows:**
- 默认HTTP代理端口：7890
- 默认SOCKS5代理端口：7891
- 配置：`proxy: "http://127.0.0.1:7890"`

**V2rayN:**
- 默认HTTP代理端口：10809
- 默认SOCKS5代理端口：10808
- 配置：`proxy: "http://127.0.0.1:10809"`

**Shadowsocks:**
- 默认SOCKS5代理端口：1080
- 配置：`proxy: "socks5://127.0.0.1:1080"`

### 方案2：更换网络环境

#### 2.1 使用手机热点
- 开启手机热点
- 电脑连接手机热点
- 重新运行程序

#### 2.2 使用VPN服务
- 连接VPN服务器
- 选择不同地区的服务器
- 重新运行程序

### 方案3：等待IP解封

#### 3.1 暂停使用
- 停止使用程序24-48小时
- 让IP地址自然解封
- 之后降低使用频率

#### 3.2 联系即梦客服
- 说明情况并申请解封
- 提供必要的身份信息
- 等待客服处理

## 🔧 增强的反检测功能

我们已经为你实现了以下反检测功能：

### 自动反检测特性
- ✅ **随机User-Agent**: 每次启动使用不同的浏览器标识
- ✅ **隐藏自动化标识**: 移除webdriver等自动化痕迹
- ✅ **模拟人类行为**: 随机延迟、真实鼠标移动
- ✅ **请求头伪装**: 设置真实浏览器的请求头
- ✅ **智能重试**: 失败时自动重试，避免频繁请求

### 下载优化
- ✅ **页面内下载**: 使用页面内的fetch API，避免直接请求
- ✅ **随机延迟**: 每次重试间隔1-3秒随机延迟
- ✅ **多次重试**: 最多重试3次，提高成功率
- ✅ **详细日志**: 显示下载进度和错误信息

## 📋 使用步骤

### 步骤1：检查网络连接
```bash
# 测试是否能访问即梦网站
curl -I https://jimeng.jianying.com
```

### 步骤2：配置代理（如果需要）
编辑 `lib/auto-deepseek-jimeng/jimeng-config.mjs`：
```javascript
// 取消注释并配置你的代理
proxy: "http://127.0.0.1:7890", // 替换为你的代理地址
```

### 步骤3：运行程序
```bash
npx node-ffmpeg-tools auto-deepseek-jimeng
```

### 步骤4：观察日志
查看是否有以下成功标识：
```
🌐 使用代理: http://127.0.0.1:7890
🎭 使用User-Agent: Mozilla/5.0...
✅ 图片下载成功 (12345 bytes)
```

## 🔍 故障排除

### 问题1：代理连接失败
**错误信息**: `net::ERR_PROXY_CONNECTION_FAILED`
**解决方案**:
- 检查代理软件是否正在运行
- 确认代理端口号是否正确
- 尝试不同的代理协议（HTTP/SOCKS5）

### 问题2：下载仍然失败
**错误信息**: `HTTP 403: Forbidden` 或 `HTTP 429: Too Many Requests`
**解决方案**:
- 更换代理服务器地区
- 增加请求间隔时间
- 暂停使用一段时间

### 问题3：代理速度慢
**现象**: 程序运行很慢，经常超时
**解决方案**:
- 选择延迟较低的代理服务器
- 使用付费代理服务
- 调整超时时间设置

## 🎯 最佳实践

### 1. 合理使用频率
- 不要连续大量下载
- 每次使用间隔至少1小时
- 避免在高峰时段使用

### 2. 代理选择建议
- 优先选择HTTP代理（兼容性更好）
- 选择延迟低于200ms的服务器
- 定期更换代理服务器

### 3. 监控使用状态
- 注意观察下载成功率
- 发现异常及时停止使用
- 保存重要的配置和数据

## 📞 技术支持

如果以上方案都无法解决问题，请：

1. **收集错误信息**：
   - 完整的错误日志
   - 网络环境描述
   - 使用的代理信息

2. **尝试最小化复现**：
   - 使用最简单的配置
   - 减少并发请求
   - 记录具体步骤

3. **联系开发者**：
   - 提供详细的问题描述
   - 附上相关日志文件
   - 说明已尝试的解决方案

---

**注意**: 使用代理和反检测功能时，请遵守相关法律法规和服务条款。本工具仅用于学习和研究目的。
